!function(){function t(){}function e(t){var e=t.length-1;return function(){var n=qe.call(arguments,0,e),i=qe.call(arguments,e);return t.apply(this,n.concat([i]))}}function n(t){return e(function(e,n){"function"!=typeof e&&(e=ye(e));var i=function(t){return e.apply(t,[t].concat(n))};return t.call(this,i)})}function i(t){var e=qe.call(arguments,1);return function(){return t.apply(this,e)}}function s(t,e){if(!e)throw new Error("prayer failed: "+t)}function r(t){s("a direction was passed",t===je||t===ke)}function o(t,e,n){s("a parent is always present",t),s("leftward is properly set up",function(){return e?e[ke]===n&&e.parent===t:t.ends[je]===n}()),s("rightward is properly set up",function(){return n?n[je]===e&&n.parent===t:t.ends[ke]===e}())}function a(t){if(!t||!t.nodeType)return null;var e=Qe(t).children(".mq-root-block").attr(ve);return e?Ce.byId[e].controller.API:null}function c(t){function e(e,n){var i=a(e);return i instanceof t||!e||!e.nodeType?i:t(Qe(e),n)}return e.prototype=t.prototype,e}function l(t){var e,n="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf reflow".split(" ");for(e=0;e<n.length;e+=1)(function(e){t[e]=function(t){this.controller.handle(e,t)}})(n[e])}function u(t,e,n){return Oe(D,{ctrlSeq:t,htmlTemplate:"<"+e+" "+n+">&0</"+e+">"})}function h(t){var e=this.parent,n=t;do{if(n[ke])return t.insLeftOf(e);n=n.parent.parent}while(n!==e);t.insRightOf(e)}function f(t,e){t.jQadd=function(){e.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},t.reflow=function(){var t=this.contentjQ.outerHeight()/parseInt(this.contentjQ.css("fontSize"),10);G(this.delimjQs,we(1+.2*(t-1),1.2),1.05*t)}}function p(t,e){var e=e||t,n=he[t],s=he[e];_e[t]=i(ue,je,t,n,e,s),_e[n]=i(ue,ke,t,n,e,s)}var d,m,g,b,v,w,x,q,y,O,j,k,Q,T,C,S,D,_,A,L,E,R,I,z,B,P,F,$,M,N,U,W,H,G,K,X,Z,Y,J,V,te,ee,ne,ie,se,re,oe,ae,ce,le,ue,he,fe,pe,de,me,ge=window.jQuery,be="mathquill-command-id",ve="mathquill-block-id",we=Math.min,xe=Math.max,qe=[].slice,ye=e(function(t,n){return e(function(e,i){return t in e?e[t].apply(e,n.concat(i)):void 0})}),Oe=function(t,e,n){function i(t){return"object"==typeof t}function s(t){return"function"==typeof t}function r(){}return function o(a,c){function l(){var t=new u;return s(t.init)&&t.init.apply(t,arguments),t}function u(){}var h,f,p;return c===n&&(c=a,a=Object),l.Bare=u,h=r[t]=a[t],f=u[t]=l[t]=l.p=new r,f.constructor=l,l.mixin=function(e){return u[t]=l[t]=o(l,e)[t],l},(l.open=function(t){if(p={},s(t)?p=t.call(l,f,h,l,a):i(t)&&(p=t),i(p))for(var n in p)e.call(p,n)&&(f[n]=p[n]);return s(f.init)||(f.init=a),l})(c)}}("prototype",{}.hasOwnProperty),je=a.L=-1,ke=a.R=1,Qe=Oe(ge,function(t){t.insDirOf=function(t,e){return t===je?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===je?this.prependTo(e):this.appendTo(e)}}),Te=Oe(function(t){t.parent=0,t[je]=0,t[ke]=0,t.init=function(t,e,n){this.parent=t,this[je]=e,this[ke]=n},this.copy=function(t){return Te(t.parent,t[je],t[ke])}}),Ce=Oe(function(t){function e(){return i+=1}t[je]=0,t[ke]=0,t.parent=0;var i=0;this.byId={},t.init=function(){this.id=e(),Ce.byId[this.id]=this,this.ends={},this.ends[je]=0,this.ends[ke]=0},t.dispose=function(){delete Ce.byId[this.id]},t.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},t.jQ=Qe(),t.jQadd=function(t){return this.jQ=this.jQ.add(t)},t.jQize=function(t){function e(t){var n,i;for(t.getAttribute&&(n=t.getAttribute("mathquill-command-id"),i=t.getAttribute("mathquill-block-id"),n&&Ce.byId[n].jQadd(t),i&&Ce.byId[i].jQadd(t)),t=t.firstChild;t;t=t.nextSibling)e(t)}var n;for(t=Qe(t||this.html()),n=0;n<t.length;n+=1)e(t[n]);return t},t.createDir=function(t,e){r(t);var n=this;return n.jQize(),n.jQ.insDirOf(t,e.jQ),e[t]=n.adopt(e.parent,e[je],e[ke]),n},t.createLeftOf=function(t){return this.createDir(je,t)},t.selectChildren=function(t,e){return Le(t,e)},t.bubble=n(function(t){var e,n;for(e=this;e&&(n=t(e),n!==!1);e=e.parent);return this}),t.postOrder=n(function(t){return function e(n){n.eachChild(e),t(n)}(this),this}),t.isEmpty=function(){return 0===this.ends[je]&&0===this.ends[ke]},t.children=function(){return Se(this.ends[je],this.ends[ke])},t.eachChild=function(){var t=this.children();return t.each.apply(t,arguments),this},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.withDirAdopt=function(t,e,n,i){return Se(this,this).withDirAdopt(t,e,n,i),this},t.adopt=function(t,e,n){return Se(this,this).adopt(t,e,n),this},t.disown=function(){return Se(this,this).disown(),this},t.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),Se=Oe(function(t){t.init=function(t,e,n){n===d&&(n=je),r(n),s("no half-empty fragments",!t==!e),this.ends={},t&&(s("withDir is passed to Fragment",t instanceof Ce),s("oppDir is passed to Fragment",e instanceof Ce),s("withDir and oppDir have the same parent",t.parent===e.parent),this.ends[n]=t,this.ends[-n]=e,this.jQ=this.fold(this.jQ,function(t,e){return t.add(e.jQ)}))},t.jQ=Qe(),t.withDirAdopt=function(t,e,n,i){return t===je?this.adopt(e,n,i):this.adopt(e,i,n)},t.adopt=function(t,e,n){var i,s,r;return o(t,e,n),i=this,i.disowned=!1,(s=i.ends[je])?(r=i.ends[ke],e||(t.ends[je]=s),n?n[je]=r:t.ends[ke]=r,i.ends[ke][ke]=n,i.each(function(n){n[je]=e,n.parent=t,e&&(e[ke]=n),e=n}),i):this},t.disown=function(){var t,e,n=this,i=n.ends[je];return!i||n.disowned?n:(n.disowned=!0,t=n.ends[ke],e=i.parent,o(e,i[je],i),o(e,t,t[ke]),i[je]?i[je][ke]=t[ke]:e.ends[je]=t[ke],t[ke]?t[ke][je]=i[je]:e.ends[ke]=i[je],n)},t.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},t.each=n(function(t){var e,n=this,i=n.ends[je];if(!i)return n;for(;i!==n.ends[ke][ke]&&(e=t(i),e!==!1);i=i[ke]);return n}),t.fold=function(t,e){return this.each(function(n){t=e.call(this,t,n)}),t}}),De={},_e={},Ae=Oe(Te,function(t){t.init=function(t,e){this.parent=t,this.options=e;var n=this.jQ=this._jQ=Qe('<span class="mq-cursor">&zwj;</span>');this.blink=function(){n.toggleClass("mq-blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[ke]?this.jQ.insertBefore(this.selection&&this.selection.ends[je][je]===this[je]?this.selection.jQ:this[ke].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=Qe(),this},t.withDirInsertAt=function(t,e,n,i){e!==this.parent&&this.parent.blur&&this.parent.blur(),this.parent=e,this[t]=n,this[-t]=i},t.insDirOf=function(t,e){return r(t),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("mq-hasCursor"),this.jQ.insDirOf(t,e.jQ),this},t.insLeftOf=function(t){return this.insDirOf(je,t)},t.insRightOf=function(t){return this.insDirOf(ke,t)},t.insAtDirEnd=function(t,e){return r(t),this.withDirInsertAt(t,e,0,e.ends[t]),this.jQ.insAtDirEnd(t,e.jQ),e.focus(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(je,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(ke,t)},t.jumpUpDown=function(t,e){var n,i,s=this;s.upDownCache[t.id]=Te.copy(s),n=s.upDownCache[e.id],n?n[ke]?s.insLeftOf(n[ke]):s.insAtRightEnd(n.parent):(i=s.offset().left,e.seek(i,s))},t.offset=function(){var t=this,e=t.jQ.removeClass("mq-cursor").offset();return t.jQ.addClass("mq-cursor"),e},t.unwrapGramp=function(){var t=this.parent.parent,e=t.parent,n=t[ke],i=this,s=t[je];if(t.disown().eachChild(function(i){i.isEmpty()||(i.children().adopt(e,s,n).each(function(e){e.jQ.insertBefore(t.jQ.first())}),s=i.ends[ke])}),!this[ke])if(this[je])this[ke]=this[je][ke];else for(;!this[ke];){if(this.parent=this.parent[ke],!this.parent){this[ke]=t[ke],this.parent=e;break}this[ke]=this.parent.ends[je]}this[ke]?this.insLeftOf(this[ke]):this.insAtRightEnd(e),t.jQ.remove(),t[je].siblingDeleted&&t[je].siblingDeleted(i.options,ke),t[ke].siblingDeleted&&t[ke].siblingDeleted(i.options,je)},t.startSelection=function(){var t,e=this.anticursor=Te.copy(this),n=e.ancestors={};for(t=e;t.parent;t=t.parent)n[t.parent.id]=t},t.endSelection=function(){delete this.anticursor},t.select=function(){var t,e,n,i,r,o,a,c=this.anticursor;if(this[je]===c[je]&&this.parent===c.parent)return!1;for(t=this;t.parent;t=t.parent)if(t.parent.id in c.ancestors){e=t.parent;break}if(s("cursor and anticursor in the same tree",e),n=c.ancestors[e.id],o=ke,t[je]!==n)for(a=t;a;a=a[ke])if(a[ke]===n[ke]){o=je,i=t,r=n;break}return o===ke&&(i=n,r=t),i instanceof Te&&(i=i[ke]),r instanceof Te&&(r=r[je]),this.hide().selection=e.selectChildren(i,r),this.insDirOf(o,this.selection.ends[o]),this.selectionChanged(),!0},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},t.deleteSelection=function(){this.selection&&(this[je]=this.selection.ends[je][je],this[ke]=this.selection.ends[ke][ke],this.selection.remove(),this.selectionChanged(),delete this.selection)},t.replaceSelection=function(){var t=this.selection;return t&&(this[je]=t.ends[je][je],this[ke]=t.ends[ke][ke],delete this.selection),t}}),Le=Oe(Se,function(t,e){t.init=function(){e.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},t.join=function(t){return this.fold("",function(e,n){return e+n[t]()})}}),Ee=Oe(function(t){t.init=function(t,e,n){this.API=t,this.root=e,this.container=n,t.__controller=e.controller=this,this.cursor=e.cursor=Ae(e,t.__options)},t.handle=function(t,e){var n=this.API.__options.handlers;n&&n[t]&&(e===je||e===ke?n[t](e,this.API):n[t](this.API))};var e=[];this.onNotify=function(t){e.push(t)},t.notify=function(){for(var t=0;t<e.length;t+=1)e[t].apply(this.cursor,arguments);return this}});a.noConflict=function(){return window.MathQuill=m,a},m=window.MathQuill,window.MathQuill=a,g=Oe(),b={},a.__options=g.p,v=Oe(function(t){t.init=function(){throw"wtf don't call me, I'm 'abstract'"},t.initRoot=function(t,e,n){var i,s;this.__options=g(),this.config(n),i=Ee(this,t,e),i.createTextarea(),s=e.contents().detach(),t.jQ=Qe('<span class="mq-root-block"/>').attr(ve,t.id).appendTo(e),this.latex(s.text()),this.revert=function(){return e.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(s)}},t.config=a.config=function(t){var e,n,i;for(e in t)t.hasOwnProperty(e)&&(n=t[e],i=b[e],this.__options[e]=i?i(n):n);return this},t.el=function(){return this.__controller.container[0]},t.text=function(){return this.__controller.exportText()},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexMath(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},t.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},t.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}),a.prototype=v.prototype,a.StaticMath=c(Oe(v,function(t,e){t.init=function(t){this.initRoot(C(),t.addClass("mq-math-mode")),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents()},t.latex=function(){var t=e.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[]),t}})),w=a.EditableField=Oe(v,function(e){e.initRootAndEvents=function(t,e,n){this.initRoot(t,e,n),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents()},e.focus=function(){return this.__controller.textarea.focus(),this},e.blur=function(){return this.__controller.textarea.blur(),this},e.write=function(t){return this.__controller.writeLatex(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},e.cmd=function(t){var e,n=this.__controller.notify(),i=n.cursor.show();return/^\\[a-z]+$/i.test(t)?(t=t.slice(1),e=De[t],e&&(t=e(t),i.selection&&t.replaces(i.replaceSelection()),t.createLeftOf(i))):i.parent.write(i,t,i.replaceSelection()),n.blurred&&i.hide().parent.blur(),this},e.select=function(){var t=this.__controller;for(t.notify("move").cursor.insAtRightEnd(t.root);t.cursor[je];)t.selectLeft();return this},e.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},e.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},e.moveToLeftEnd=function(){return this.moveToDirEnd(je)},e.moveToRightEnd=function(){return this.moveToDirEnd(ke)},e.keystroke=function(e){var n;for(e=e.replace(/^\s+|\s+$/g,"").split(/\s+/),n=0;n<e.length;n+=1)this.__controller.keystroke(e[n],{preventDefault:t});return this},e.typedText=function(t){for(var e=0;e<t.length;e+=1)this.__controller.typedText(t.charAt(e));return this}}),x=Oe(function(t,e,n){function i(t,e){throw t=t?"'"+t+"'":"EOF","Parse Error: "+e+" at "+t}var r,o,a,c,l,u,h,f,p,d,m,g,b;t.init=function(t){this._=t},t.parse=function(t){function e(t,e){return e}return this.skip(b)._(t,e,i)},t.or=function(t){s("or is passed a parser",t instanceof n);var e=this;return n(function(n,i,s){function r(){return t._(n,i,s)}return e._(n,i,r)})},t.then=function(t){var e=this;return n(function(i,r,o){function a(e,i){var a=t instanceof n?t:t(i);return s("a parser is returned",a instanceof n),a._(e,r,o)}return e._(i,a,o)})},t.many=function(){var t=this;return n(function(e,n){function i(t,n){return e=t,r.push(n),!0}function s(){return!1}for(var r=[];t._(e,i,s););return n(e,r)})},t.times=function(t,e){arguments.length<2&&(e=t);var i=this;return n(function(n,s,r){function o(t,e){return h.push(e),n=t,!0}function a(t,e){return l=e,n=t,!1}function c(){return!1}var l,u,h=[],f=!0;for(u=0;t>u;u+=1)if(f=i._(n,o,a),!f)return r(n,l);for(;e>u&&f;u+=1)f=i._(n,o,c);return s(n,h)})},t.result=function(t){return this.then(a(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var e=this;return e.times(t).then(function(t){return e.many().map(function(e){return t.concat(e)})})},t.map=function(t){return this.then(function(e){return a(t(e))})},t.skip=function(t){return this.then(function(e){return t.result(e)})},r=this.string=function(t){var e=t.length,i="expected '"+t+"'";return n(function(n,s,r){var o=n.slice(0,e);return o===t?s(n.slice(e),o):r(n,i)})},o=this.regex=function(t){s("regexp parser is anchored","^"===t.toString().charAt(1));var e="expected "+t;return n(function(n,i,s){var r,o=t.exec(n);return o?(r=o[0],i(n.slice(r.length),r)):s(n,e)})},a=n.succeed=function(t){return n(function(e,n){return n(e,t)})},c=n.fail=function(t){return n(function(e,n,i){return i(e,t)})},l=n.letter=o(/^[a-z]/i),u=n.letters=o(/^[a-z]*/i),h=n.digit=o(/^[0-9]/),f=n.digits=o(/^[0-9]*/),p=n.whitespace=o(/^\s+/),d=n.optWhitespace=o(/^\s*/),m=n.any=n(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),g=n.all=n(function(t,e){return e("",t)}),b=n.eof=n(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)})}),q=function(){function e(t){var e,i=t.which||t.keyCode,s=n[i],r=[];return t.ctrlKey&&r.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&r.push("Meta"),t.altKey&&r.push("Alt"),t.shiftKey&&r.push("Shift"),e=s||String.fromCharCode(i),r.length||s?(r.push(e),r.join("-")):e}var n={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(n,i){function s(t){x=t,clearTimeout(d),d=setTimeout(t)}function r(e){x(),x=t,clearTimeout(d),v.val(e),e&&v[0].select(),m=!!e}function o(){var t=v[0];return"selectionStart"in t?t.selectionStart!==t.selectionEnd:!1}function a(){i.keystroke(e(g),g)}function c(e){g=e,b=null,m&&s(function(){v[0].select(),x=t,clearTimeout(d)}),a()}function l(t){g&&b&&a(),b=t,s(u)}function u(){if(!o()){var t=v.val();1===t.length?(v.val(""),i.typedText(t)):t&&v[0].select()}}function h(){g=b=null}function f(){v.focus(),s(p)}function p(){var t=v.val();v.val(""),t&&i.paste(t)}var d,m,g=null,b=null,v=ge(n),w=ge(i.container||v),x=t;return w.bind("keydown keypress input keyup focusout paste",function(){x()}),m=!1,w.bind({keydown:c,keypress:l,focusout:h,paste:f}),{select:r}}}(),Ee.open(function(t){t.exportText=function(){return this.root.foldChildren("",function(t,e){return t+e.text()})}}),Ee.open(function(t){t.focusBlurEvents=function(){function t(){clearTimeout(n),r.selection&&r.selection.jQ.addClass("mq-blur"),e()}function e(){r.hide().parent.blur(),i.container.removeClass("mq-focused"),Qe(window).off("blur",t)}var n,i=this,s=i.root,r=i.cursor;i.textarea.focus(function(){i.blurred=!1,clearTimeout(n),i.container.addClass("mq-focused"),r.parent||r.insAtRightEnd(s),r.selection?(r.selection.jQ.removeClass("mq-blur"),i.selectionChanged()):r.show()}).blur(function(){i.blurred=!0,n=setTimeout(function(){s.postOrder("intentionalBlur"),r.clearSelection(),e()}),Qe(window).on("blur",t)}),i.blurred=!0,r.hide().parent.blur()}}),Ee.open(function(t){t.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this)}}),Ce.open(function(t){t.keystroke=function(t,e,n){var i=n.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":for(;i[je]||i.selection;)n.backspace();break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(ke,t,e);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(je,t,e);case"End":n.notify("move").cursor.insAtRightEnd(i.parent);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root);break;case"Shift-End":for(;i[ke];)n.selectRight();break;case"Ctrl-Shift-End":for(;i[ke]||i.parent!==n.root;)n.selectRight();break;case"Home":n.notify("move").cursor.insAtLeftEnd(i.parent);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root);break;case"Shift-Home":for(;i[je];)n.selectLeft();break;case"Ctrl-Shift-Home":for(;i[je]||i.parent!==n.root;)n.selectLeft();break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Ctrl-Right":break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":if(i[je])for(;i[je];)n.selectLeft();else n.selectLeft();case"Shift-Down":if(i[ke])for(;i[ke];)n.selectRight();else n.selectRight();case"Ctrl-Up":break;case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":for(;i[ke]||i.selection;)n.deleteForward();break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":for(n.notify("move").cursor.insAtRightEnd(n.root);i[je];)n.selectLeft();break;default:return}e.preventDefault(),n.scrollHoriz()},t.moveOutOf=t.moveTowards=t.deleteOutOf=t.deleteTowards=t.unselectInto=t.selectOutOf=t.selectTowards=function(){s("overridden or never called on this node")}}),Ee.open(function(t){function e(t,e){var n=t.notify("upDown").cursor,i=e+"Into",s=e+"OutOf";return n[ke][i]?n.insAtLeftEnd(n[ke][i]):n[je][i]?n.insAtRightEnd(n[je][i]):n.parent.bubble(function(t){var e=t[s];return e&&("function"==typeof e&&(e=t[s](n)),e instanceof Ce&&n.jumpUpDown(t,e),e!==!0)?!1:void 0}),t}this.onNotify(function(t){("move"===t||"upDown"===t)&&this.show().clearSelection()}),t.escapeDir=function(t,e,n){r(t);var i=this.cursor;return i.parent!==this.root&&n.preventDefault(),i.parent!==this.root?(i.parent.moveOutOf(t,i),this.notify("move")):void 0},b.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},t.moveDir=function(t){r(t);var e=this.cursor,n=e.options.leftRightIntoCmdGoes;return e.selection?e.insDirOf(t,e.selection.ends[t]):e[t]?e[t].moveTowards(t,e,n):e.parent.moveOutOf(t,e,n),this.notify("move")},t.moveLeft=function(){return this.moveDir(je)},t.moveRight=function(){return this.moveDir(ke)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},this.onNotify(function(t){"upDown"!==t&&(this.upDownCache={})}),this.onNotify(function(t){"edit"===t&&this.show().deleteSelection()}),t.deleteDir=function(t){var e,n;return r(t),e=this.cursor,n=e.selection,this.notify("edit"),n||(e[t]?e[t].deleteTowards(t,e):e.parent.deleteOutOf(t,e)),e[je].siblingDeleted&&e[je].siblingDeleted(e.options,ke),e[ke].siblingDeleted&&e[ke].siblingDeleted(e.options,je),e.parent.bubble("reflow"),this},t.backspace=function(){return this.deleteDir(je)},t.deleteForward=function(){return this.deleteDir(ke)},this.onNotify(function(t){"select"!==t&&this.endSelection()}),t.selectDir=function(t){var e,n=this.notify("select").cursor,i=n.selection;r(t),n.anticursor||n.startSelection(),e=n[t],e?i&&i.ends[t]===e&&n.anticursor[-t]!==e?e.unselectInto(t,n):e.selectTowards(t,n):n.parent.selectOutOf(t,n),n.clearSelection(),n.select()||n.show()},t.selectLeft=function(){return this.selectDir(je)},t.selectRight=function(){return this.selectDir(ke)}}),y=function(){function t(t){var e=C();return t.adopt(e,0,0),e}function e(t){var e,n=t[0]||C();for(e=1;e<t.length;e+=1)t[e].children().adopt(n,n.ends[ke],0);return n}var n=x.string,i=x.regex,s=x.letter,r=x.any,o=x.optWhitespace,a=x.succeed,c=x.fail,l=s.map(function(t){return R(t)}),u=i(/^[^${}\\_^]/).map(function(t){return Q(t)}),h=i(/^[^\\a-eg-zA-Z]/).or(n("\\").then(i(/^[a-z]+/i).or(i(/^\s+/).result(" ")).or(r))).then(function(t){var e=De[t];return e?e(t).parser():c("unknown command: \\"+t)}),f=h.or(l).or(u),p=n("{").then(function(){return m}).skip(n("}")),d=o.then(p.or(f.map(t))),m=d.many().map(e).skip(o),g=n("[").then(d.then(function(t){return"]"!==t.join("latex")?a(t):c()}).many().map(e).skip(o)).skip(n("]")),b=m;return b.block=d,b.optBlock=g,b}(),Ee.open(function(t){t.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},t.writeLatex=function(t){var e,n=this.notify("edit").cursor,i=x.all,s=x.eof,r=y.skip(s).or(i.result(!1)).parse(t);return r&&!r.isEmpty()&&(r.children().adopt(n.parent,n[je],n[ke]),e=r.jQize(),e.insertBefore(n.jQ),n[je]=r.ends[ke],r.finalizeInsert(n.options,n),r.ends[ke][ke].siblingCreated&&r.ends[ke][ke].siblingCreated(n.options,je),r.ends[je][je].siblingCreated&&r.ends[je][je].siblingCreated(n.options,ke),n.parent.bubble("reflow")),this},t.renderLatexMath=function(t){var e,n,i=this.root,s=this.cursor,r=x.all,o=x.eof,a=y.skip(o).or(r.result(!1)).parse(t);i.eachChild("postOrder","dispose"),i.ends[je]=i.ends[ke]=0,a&&a.children().adopt(i,0,0),e=i.jQ,a?(n=a.join("html"),e.html(n),i.jQize(e.children()),i.finalizeInsert(s.options)):e.empty(),delete s.selection,s.insAtRightEnd(i)},t.renderLatexText=function(t){var e,n,i,s,r,o,a,c,l,u,h=this.root,f=this.cursor;if(h.jQ.children().slice(1).remove(),h.eachChild("postOrder","dispose"),h.ends[je]=h.ends[ke]=0,delete f.selection,f.show().insAtRightEnd(h),e=x.regex,n=x.string,i=x.eof,s=x.all,r=n("$").then(y).skip(n("$").or(i)).map(function(t){var e,n=A(f);return n.createBlocks(),e=n.ends[je],t.children().adopt(e,0,0),n}),o=n("\\$").result("$"),a=o.or(e(/^[^$]/)).map(Q),c=r.or(a).many(),l=c.skip(i).or(s.result(!1)).parse(t)){for(u=0;u<l.length;u+=1)l[u].adopt(h,h.ends[ke],0);h.jQize().appendTo(h.jQ),h.finalizeInsert(f.options)}}}),Ee.open(function(e){e.delegateMouseEvents=function(){var e=this.root.jQ;this.container.bind("mousedown.mathquill",function(n){function i(t){o=Qe(t.target)}function s(t){u.anticursor||u.startSelection(),l.seek(o,t.pageX,t.pageY).cursor.select(),o=d}function r(t){u.blink=h,u.selection||(l.editable?u.show():f.detach()),a.unbind("mousemove",i),Qe(t.target.ownerDocument).unbind("mousemove",s).unbind("mouseup",r)}var o,a=Qe(n.target).closest(".mq-root-block"),c=Ce.byId[a.attr(ve)||e.attr(ve)],l=c.controller,u=l.cursor,h=u.blink,f=l.textareaSpan,p=l.textarea;l.blurred&&(l.editable||a.prepend(f),p.focus()),n.preventDefault(),n.target.unselectable=!0,u.blink=t,l.seek(Qe(n.target),n.pageX,n.pageY).cursor.startSelection(),a.mousemove(i),Qe(n.target.ownerDocument).mousemove(s).mouseup(r)})}}),Ee.open(function(t){t.seek=function(t,e){var n,i,r,o=this.notify("select").cursor;return t&&(n=t.attr(ve)||t.attr(be),n||(i=t.parent(),n=i.attr(ve)||i.attr(be))),r=n?Ce.byId[n]:this.root,s("nodeId is the id of some Node that exists",r),o.clearSelection().show(),r.seek(e,o),this.scrollHoriz(),this}}),Ee.open(function(t){t.scrollHoriz=function(){var t,e,n,i,s,r=this.cursor,o=r.selection,a=this.root.jQ[0].getBoundingClientRect();if(o)if(n=o.jQ[0].getBoundingClientRect(),i=n.left-(a.left+20),s=n.right-(a.right-20),o.ends[je]===r[ke])if(0>i)e=i;else{if(!(s>0))return;e=n.left-s<a.left+20?i:s}else if(s>0)e=s;else{if(!(0>i))return;e=n.right-i>a.right-20?s:i}else if(t=r.jQ[0].getBoundingClientRect().left,t>a.right-20)e=t-(a.right-20);else{if(!(t<a.left+20))return;e=t-(a.left+20)}this.root.jQ.stop().animate({scrollLeft:"+="+e},100)}}),Ee.open(function(t){g.p.substituteTextarea=function(){return Qe("<textarea>")[0]},t.createTextarea=function(){var t,e=this.textareaSpan=Qe('<span class="mq-textarea"></span>'),n=this.API.__options.substituteTextarea();if(!n.nodeType)throw"substituteTextarea() must return a DOM element, got "+n;n=this.textarea=Qe(n).appendTo(e),t=this,t.cursor.selectionChanged=function(){t.selectionChanged()},t.container.bind("copy",function(){t.setTextareaSelection()})},t.selectionChanged=function(){var t=this;K(t.container[0]),t.textareaSelectionTimeout===d&&(t.textareaSelectionTimeout=setTimeout(function(){t.setTextareaSelection()}))},t.setTextareaSelection=function(){this.textareaSelectionTimeout=d;var t="";this.cursor.selection&&(t=this.cursor.selection.join("latex"),this.API.__options.statelessClipboard&&(t="$"+t+"$")),this.selectFn(t)},t.staticMathTextareaEvents=function(){function t(){s.detach(),e.blurred=!0}var e=this,n=(e.root,e.cursor),i=e.textarea,s=e.textareaSpan;this.container.prepend('<span class="mq-selectable">$'+e.exportLatex()+"$</span>"),e.blurred=!0,i.bind("cut paste",!1).focus(function(){e.blurred=!1}).blur(function(){n.selection&&n.selection.clear(),setTimeout(t)}),e.selectFn=function(t){i.val(t),t&&i.select()}},t.editablesTextareaEvents=function(){var t=this,e=(t.root,t.cursor),n=t.textarea,i=t.textareaSpan,s=q(n,this);this.selectFn=function(t){s.select(t)},this.container.prepend(i).on("cut",function(){e.selection&&setTimeout(function(){t.notify("edit"),e.parent.bubble("reflow")})}),this.focusBlurEvents()},t.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify().cursor;e.parent.write(e,t,e.show().replaceSelection()),this.scrollHoriz()},t.paste=function(t){this.API.__options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show()}}),O=Oe(Ce,function(t){t.finalizeInsert=function(t,e){var n=this;n.postOrder("finalizeTree",t),n.postOrder("contactWeld",e),n.postOrder("blur"),n.postOrder("reflow"),n[ke].siblingCreated&&n[ke].siblingCreated(t,je),n[je].siblingCreated&&n[je].siblingCreated(t,ke),n.bubble("reflow")}}),j=Oe(O,function(t,e){t.init=function(t,n,i){var s=this;e.init.call(s),s.ctrlSeq||(s.ctrlSeq=t),n&&(s.htmlTemplate=n),i&&(s.textTemplate=i)},t.replaces=function(t){t.disown(),this.replacedFragment=t},t.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},t.parser=function(){var t=y.block,e=this;return t.times(e.numBlocks()).map(function(t){e.blocks=t;for(var n=0;n<t.length;n+=1)t[n].adopt(e,e.ends[ke],0);return e})},t.createLeftOf=function(t){var n=this,i=n.replacedFragment;n.createBlocks(),e.createLeftOf.call(n,t),i&&(i.adopt(n.ends[je],0,0),i.jQ.appendTo(n.ends[je].jQ)),n.finalizeInsert(t.options),n.placeCursor(t)},t.createBlocks=function(){var t,e,n=this,i=n.numBlocks(),s=n.blocks=Array(i);for(t=0;i>t;t+=1)e=s[t]=C(),e.adopt(n,n.ends[ke],0)},t.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[je],function(t,e){return t.isEmpty()?t:e}))},t.moveTowards=function(t,e,n){var i=n&&this[n+"Into"];e.insAtDirEnd(-t,i||this.ends[-t])},t.deleteTowards=function(t,e){e.startSelection(),this.selectTowards(t,e),e.select()},t.selectTowards=function(t,e){e[-t]=this,e[t]=this[t]},t.selectChildren=function(){return Le(this,this)},t.unselectInto=function(t,e){e.insAtDirEnd(-t,e.anticursor.ancestors[this.id])},t.seek=function(t,e){function n(t){var e={};return e[je]=t.jQ.offset().left,e[ke]=e[je]+t.jQ.outerWidth(),e}var i,s=this,r=n(s);return t<r[je]?e.insLeftOf(s):t>r[ke]?e.insRightOf(s):(i=r[je],void s.eachChild(function(o){var a=n(o);return t<a[je]?(t-i<a[je]-t?o[je]?e.insAtRightEnd(o[je]):e.insLeftOf(s):e.insAtLeftEnd(o),!1):t>a[ke]?void(o[ke]?i=a[ke]:r[ke]-t<t-a[ke]?e.insRightOf(s):e.insAtRightEnd(o)):(o.seek(t,e),!1)}))},t.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},t.html=function(){var t,e,n,i=this,r=i.blocks,o=" mathquill-command-id="+i.id,a=i.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);for(s("no unmatched angle brackets",a.join("")===this.htmlTemplate),t=0,e=a[0];e;t+=1,e=a[t])if("/>"===e.slice(-2))a[t]=e.slice(0,-2)+o+"/>";else if("<"===e.charAt(0)){s("not an unmatched top-level close tag","/"!==e.charAt(1)),a[t]=e.slice(0,-1)+o+">",n=1;do t+=1,e=a[t],s("no missing close tags",e),"</"===e.slice(0,2)?n-=1:"<"===e.charAt(0)&&"/>"!==e.slice(-2)&&(n+=1);while(n>0)}return a.join("").replace(/>&(\d+)/g,function(t,e){return" mathquill-block-id="+r[e].id+">"+r[e].join("html")})},t.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,e){return t+"{"+(e.latex()||" ")+"}"})},t.textTemplate=[""],t.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],function(n,i){e+=1;var s=i.text();return n&&"("===t.textTemplate[e]&&"("===s[0]&&")"===s.slice(-1)?n+s.slice(1,-1)+t.textTemplate[e]:n+i.text()+(t.textTemplate[e]||"")})}}),k=Oe(j,function(e,n){e.init=function(t,e,i){i||(i=t&&t.length>1?t.slice(1):t),n.init.call(this,t,e,[i])},e.parser=function(){return x.succeed(this)},e.numBlocks=function(){return 0},e.replaces=function(t){t.remove()},e.createBlocks=t,e.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ),e[-t]=this,e[t]=this[t]},e.deleteTowards=function(t,e){e[t]=this.remove()[t]},e.seek=function(t,e){t-this.jQ.offset().left<this.jQ.outerWidth()/2?e.insLeftOf(this):e.insRightOf(this)},e.latex=function(){return this.ctrlSeq},e.text=function(){return this.textTemplate},e.placeCursor=t,e.isEmpty=function(){return!0}}),Q=Oe(k,function(t,e){t.init=function(t,n){e.init.call(this,t,"<span>"+(n||t)+"</span>")}}),T=Oe(k,function(t,e){t.init=function(t,n,i){e.init.call(this,t,'<span class="mq-binary-operator">'+n+"</span>",i)}}),C=Oe(O,function(t,e){t.join=function(t){return this.foldChildren("",function(e,n){return e+n[t]()})},t.html=function(){return this.join("html")},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[je]===this.ends[ke]?this.ends[je].text():"("+this.join("text")+")"},t.keystroke=function(t,n,i){return!i.API.__options.spaceBehavesLikeTab||"Spacebar"!==t&&"Shift-Spacebar"!==t?e.keystroke.apply(this,arguments):(n.preventDefault(),void i.escapeDir("Shift-Spacebar"===t?je:ke,t,n))},t.moveOutOf=function(t,e,n){var i=n&&this.parent[n+"Into"];!i&&this[t]?e.insAtDirEnd(-t,this[t]):e.insDirOf(t,this.parent)},t.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},t.deleteOutOf=function(t,e){e.unwrapGramp()},t.seek=function(t,e){var n=this.ends[ke];if(!n||n.jQ.offset().left+n.jQ.outerWidth()<t)return e.insAtRightEnd(this);if(t<this.ends[je].jQ.offset().left)return e.insAtLeftEnd(this);for(;t<n.jQ.offset().left;)n=n[je];return n.seek(t,e)},t.write=function(t,e,n){var i;i=e.match(/^[a-eg-zA-Z]$/)?R(e):(i=_e[e]||De[e])?i(e):Q(e),n&&i.replaces(n),i.createLeftOf(t)},t.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this
},t.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}),S=Oe(C,l),a.MathField=c(Oe(w,function(t){t.init=function(t,e){t.addClass("mq-editable-field mq-math-mode"),this.initRootAndEvents(S(),t,e)}})),D=Oe(Ce,function(t,e){function n(t){var e,n;return t.jQ[0].normalize(),e=t.jQ[0].firstChild,n=_(e.data),n.jQadd(e),t.children().disown(),n.adopt(t,0,0)}t.ctrlSeq="\\text",t.replaces=function(t){t instanceof Se?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},t.jQadd=function(t){e.jQadd.call(this,t),this.ends[je]&&this.ends[je].jQadd(this.jQ[0].firstChild)},t.createLeftOf=function(t){var n,i=this;if(e.createLeftOf.call(this,t),i[ke].siblingCreated&&i[ke].siblingCreated(t.options,je),i[je].siblingCreated&&i[je].siblingCreated(t.options,ke),i.bubble("reflow"),t.insAtRightEnd(i),i.replacedText)for(n=0;n<i.replacedText.length;n+=1)i.write(t,i.replacedText.charAt(n))},t.parser=function(){var t=this,e=x.string,n=x.regex,i=x.optWhitespace;return i.then(e("{")).then(n(/^[^}]*/)).skip(e("}")).map(function(e){return _(e).adopt(t,0,0),t})},t.textContents=function(){return this.foldChildren("",function(t,e){return t+e.text})},t.text=function(){return'"'+this.textContents()+'"'},t.latex=function(){return"\\text{"+this.textContents()+"}"},t.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},t.moveTowards=function(t,e){e.insAtDirEnd(-t,this)},t.moveOutOf=function(t,e){e.insDirOf(t,this)},t.unselectInto=t.moveTowards,t.selectTowards=j.prototype.selectTowards,t.deleteTowards=j.prototype.deleteTowards,t.selectOutOf=function(t,e){e.insDirOf(t,this)},t.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this)},t.write=function(t,n,i){var s,r;i&&i.remove(),"$"!==n?t[je]?t[je].appendText(n):_(n).createLeftOf(t):this.isEmpty()?(t.insRightOf(this),Q("\\$","$").createLeftOf(t)):t[ke]?t[je]?(s=D(),r=this.ends[je],r.disown(),r.adopt(s,0,0),t.insLeftOf(this),e.createLeftOf.call(s,t)):t.insLeftOf(this):t.insRightOf(this)},t.seek=function(t,e){var i,s,r,o,a,c,l,u;for(e.hide(),i=n(this),s=this.jQ.width()/this.text.length,r=Math.round((t-this.jQ.offset().left)/s),0>=r?e.insAtLeftEnd(this):r>=i.text.length?e.insAtRightEnd(this):e.insLeftOf(i.splitRight(r)),o=t-e.show().offset().left,a=o&&0>o?je:ke,c=a;e[a]&&o*c>0;)e[a].moveTowards(a,e),c=o,o=t-e.offset().left;-a*c>a*o&&e[-a].moveTowards(-a,e),e.anticursor?e.anticursor.parent===this&&(l=e[je]&&e[je].text.length,this.anticursorPosition===l?e.anticursor=Te.copy(e):(this.anticursorPosition<l?(u=e[je].splitRight(this.anticursorPosition),e[je]=u):u=e[ke].splitRight(this.anticursorPosition-l),e.anticursor=Te(this,u[je],u))):this.anticursorPosition=e[je]&&e[je].text.length},t.blur=function(){C.prototype.blur.call(this),n(this)},t.focus=C.prototype.focus}),_=Oe(Ce,function(t,e){function n(t,e){return e.charAt(t===je?0:-1+e.length)}t.init=function(t){e.init.call(this),this.text=t},t.jQadd=function(t){this.dom=t,this.jQ=Qe(t)},t.jQize=function(){return this.jQadd(document.createTextNode(this.text))},t.appendText=function(t){this.text+=t,this.dom.appendData(t)},t.prependText=function(t){this.text=t+this.text,this.dom.insertData(0,t)},t.insTextAtDirEnd=function(t,e){r(e),e===ke?this.appendText(t):this.prependText(t)},t.splitRight=function(t){var e=_(this.text.slice(t)).adopt(this.parent,this,this[ke]);return e.jQadd(this.dom.splitText(t)),this.text=this.text.slice(0,t),e},t.moveTowards=function(t,e){var i,s;return r(t),i=n(-t,this.text),s=this[-t],s?s.insTextAtDirEnd(i,t):_(i).createDir(-t,e),this.deleteTowards(t,e)},t.latex=function(){return this.text},t.deleteTowards=function(t,e){this.text.length>1?t===ke?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),e[t]=this[t])},t.selectTowards=function(t,e){var i,s,o,a;return r(t),i=e.anticursor,s=n(-t,this.text),i[t]===this?(o=_(s).createDir(t,e),i[t]=o,e.insDirOf(t,o)):(a=this[-t],a?a.insTextAtDirEnd(s,t):(o=_(s).createDir(-t,e),o.jQ.insDirOf(-t,e.selection.jQ)),1===this.text.length&&i[-t]===this&&(i[-t]=this[-t])),this.deleteTowards(t,e)}}),_e.$=De.text=De.textnormal=De.textrm=De.textup=De.textmd=D,De.em=De.italic=De.italics=De.emph=De.textit=De.textsl=u("\\textit","i",'class="mq-text-mode"'),De.strong=De.bold=De.textbf=u("\\textbf","b",'class="mq-text-mode"'),De.sf=De.textsf=u("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),De.tt=De.texttt=u("\\texttt","span",'class="mq-monospace mq-text-mode"'),De.textsc=u("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),De.uppercase=u("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),De.lowercase=u("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"'),A=Oe(j,function(t,e){t.init=function(t){e.init.call(this,"$"),this.cursor=t},t.htmlTemplate='<span class="mq-math-mode">&0</span>',t.createBlocks=function(){e.createBlocks.call(this),this.ends[je].cursor=this.cursor,this.ends[je].write=function(t,e,n){"$"!==e?C.prototype.write.call(this,t,e,n):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(dir,t),Q("\\$","$").createLeftOf(t.show())):t[ke]?t[je]?C.prototype.write.call(this,t,e,n):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.latex=function(){return"$"+this.ends[je].latex()+"$"}}),L=Oe(S,function(t,e){t.keystroke=function(t){return"Spacebar"!==t&&"Shift-Spacebar"!==t?e.keystroke.apply(this,arguments):void 0},t.write=function(t,e,n){if(n&&n.remove(),"$"===e)A(t).createLeftOf(t);else{var i;"<"===e?i="&lt;":">"===e&&(i="&gt;"),Q(e,i).createLeftOf(t)}}}),a.TextField=c(Oe(w,function(t){t.init=function(t){t.addClass("mq-editable-field mq-text-mode"),this.initRootAndEvents(L(),t)},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexText(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})),De.notin=De.sim=De.cong=De.equiv=De.oplus=De.otimes=Oe(T,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),De["≠"]=De.ne=De.neq=i(T,"\\ne ","&ne;"),De.ast=De.star=De.loast=De.lowast=i(T,"\\ast ","&lowast;"),De.therefor=De.therefore=i(T,"\\therefore ","&there4;"),De.cuz=De.because=i(T,"\\because ","&#8757;"),De.prop=De.propto=i(T,"\\propto ","&prop;"),De["≈"]=De.asymp=De.approx=i(T,"\\approx ","&asymp;"),De.isin=De["in"]=i(T,"\\in ","&isin;"),De.ni=De.contains=i(T,"\\ni ","&ni;"),De.notni=De.niton=De.notcontains=De.doesnotcontain=i(T,"\\not\\ni ","&#8716;"),De.sub=De.subset=i(T,"\\subset ","&sub;"),De.sup=De.supset=De.superset=i(T,"\\supset ","&sup;"),De.nsub=De.notsub=De.nsubset=De.notsubset=i(T,"\\not\\subset ","&#8836;"),De.nsup=De.notsup=De.nsupset=De.notsupset=De.nsuperset=De.notsuperset=i(T,"\\not\\supset ","&#8837;"),De.sube=De.subeq=De.subsete=De.subseteq=i(T,"\\subseteq ","&sube;"),De.supe=De.supeq=De.supsete=De.supseteq=De.supersete=De.superseteq=i(T,"\\supseteq ","&supe;"),De.nsube=De.nsubeq=De.notsube=De.notsubeq=De.nsubsete=De.nsubseteq=De.notsubsete=De.notsubseteq=i(T,"\\not\\subseteq ","&#8840;"),De.nsupe=De.nsupeq=De.notsupe=De.notsupeq=De.nsupsete=De.nsupseteq=De.notsupsete=De.notsupseteq=De.nsupersete=De.nsuperseteq=De.notsupersete=De.notsuperseteq=i(T,"\\not\\supseteq ","&#8841;"),De.N=De.naturals=De.Naturals=i(Q,"\\mathbb{N}","&#8469;"),De.P=De.primes=De.Primes=De.projective=De.Projective=De.probability=De.Probability=i(Q,"\\mathbb{P}","&#8473;"),De.Z=De.integers=De.Integers=i(Q,"\\mathbb{Z}","&#8484;"),De.Q=De.rationals=De.Rationals=i(Q,"\\mathbb{Q}","&#8474;"),De.R=De.reals=De.Reals=i(Q,"\\mathbb{R}","&#8477;"),De.C=De.complex=De.Complex=De.complexes=De.Complexes=De.complexplane=De.Complexplane=De.ComplexPlane=i(Q,"\\mathbb{C}","&#8450;"),De.H=De.Hamiltonian=De.quaternions=De.Quaternions=i(Q,"\\mathbb{H}","&#8461;"),De.quad=De.emsp=i(Q,"\\quad ","    "),De.qquad=i(Q,"\\qquad ","        "),De.diamond=i(Q,"\\diamond ","&#9671;"),De.bigtriangleup=i(Q,"\\bigtriangleup ","&#9651;"),De.ominus=i(Q,"\\ominus ","&#8854;"),De.uplus=i(Q,"\\uplus ","&#8846;"),De.bigtriangledown=i(Q,"\\bigtriangledown ","&#9661;"),De.sqcap=i(Q,"\\sqcap ","&#8851;"),De.triangleleft=i(Q,"\\triangleleft ","&#8882;"),De.sqcup=i(Q,"\\sqcup ","&#8852;"),De.triangleright=i(Q,"\\triangleright ","&#8883;"),De.odot=i(Q,"\\odot ","&#8857;"),De.bigcirc=i(Q,"\\bigcirc ","&#9711;"),De.dagger=i(Q,"\\dagger ","&#0134;"),De.ddagger=i(Q,"\\ddagger ","&#135;"),De.wr=i(Q,"\\wr ","&#8768;"),De.amalg=i(Q,"\\amalg ","&#8720;"),De.models=i(Q,"\\models ","&#8872;"),De.prec=i(Q,"\\prec ","&#8826;"),De.succ=i(Q,"\\succ ","&#8827;"),De.preceq=i(Q,"\\preceq ","&#8828;"),De.succeq=i(Q,"\\succeq ","&#8829;"),De.simeq=i(Q,"\\simeq ","&#8771;"),De.mid=i(Q,"\\mid ","&#8739;"),De.ll=i(Q,"\\ll ","&#8810;"),De.gg=i(Q,"\\gg ","&#8811;"),De.parallel=i(Q,"\\parallel ","&#8741;"),De.bowtie=i(Q,"\\bowtie ","&#8904;"),De.sqsubset=i(Q,"\\sqsubset ","&#8847;"),De.sqsupset=i(Q,"\\sqsupset ","&#8848;"),De.smile=i(Q,"\\smile ","&#8995;"),De.sqsubseteq=i(Q,"\\sqsubseteq ","&#8849;"),De.sqsupseteq=i(Q,"\\sqsupseteq ","&#8850;"),De.doteq=i(Q,"\\doteq ","&#8784;"),De.frown=i(Q,"\\frown ","&#8994;"),De.vdash=i(Q,"\\vdash ","&#8870;"),De.dashv=i(Q,"\\dashv ","&#8867;"),De.longleftarrow=i(Q,"\\longleftarrow ","&#8592;"),De.longrightarrow=i(Q,"\\longrightarrow ","&#8594;"),De.Longleftarrow=i(Q,"\\Longleftarrow ","&#8656;"),De.Longrightarrow=i(Q,"\\Longrightarrow ","&#8658;"),De.longleftrightarrow=i(Q,"\\longleftrightarrow ","&#8596;"),De.updownarrow=i(Q,"\\updownarrow ","&#8597;"),De.Longleftrightarrow=i(Q,"\\Longleftrightarrow ","&#8660;"),De.Updownarrow=i(Q,"\\Updownarrow ","&#8661;"),De.mapsto=i(Q,"\\mapsto ","&#8614;"),De.nearrow=i(Q,"\\nearrow ","&#8599;"),De.hookleftarrow=i(Q,"\\hookleftarrow ","&#8617;"),De.hookrightarrow=i(Q,"\\hookrightarrow ","&#8618;"),De.searrow=i(Q,"\\searrow ","&#8600;"),De.leftharpoonup=i(Q,"\\leftharpoonup ","&#8636;"),De.rightharpoonup=i(Q,"\\rightharpoonup ","&#8640;"),De.swarrow=i(Q,"\\swarrow ","&#8601;"),De.leftharpoondown=i(Q,"\\leftharpoondown ","&#8637;"),De.rightharpoondown=i(Q,"\\rightharpoondown ","&#8641;"),De.nwarrow=i(Q,"\\nwarrow ","&#8598;"),De.ldots=i(Q,"\\ldots ","&#8230;"),De.cdots=i(Q,"\\cdots ","&#8943;"),De.vdots=i(Q,"\\vdots ","&#8942;"),De.ddots=i(Q,"\\ddots ","&#8944;"),De.surd=i(Q,"\\surd ","&#8730;"),De.triangle=i(Q,"\\triangle ","&#9653;"),De.ell=i(Q,"\\ell ","&#8467;"),De.top=i(Q,"\\top ","&#8868;"),De.flat=i(Q,"\\flat ","&#9837;"),De.natural=i(Q,"\\natural ","&#9838;"),De.sharp=i(Q,"\\sharp ","&#9839;"),De.wp=i(Q,"\\wp ","&#8472;"),De.bot=i(Q,"\\bot ","&#8869;"),De.clubsuit=i(Q,"\\clubsuit ","&#9827;"),De.diamondsuit=i(Q,"\\diamondsuit ","&#9826;"),De.heartsuit=i(Q,"\\heartsuit ","&#9825;"),De.spadesuit=i(Q,"\\spadesuit ","&#9824;"),De.oint=i(Q,"\\oint ","&#8750;"),De.bigcap=i(Q,"\\bigcap ","&#8745;"),De.bigcup=i(Q,"\\bigcup ","&#8746;"),De.bigsqcup=i(Q,"\\bigsqcup ","&#8852;"),De.bigvee=i(Q,"\\bigvee ","&#8744;"),De.bigwedge=i(Q,"\\bigwedge ","&#8743;"),De.bigodot=i(Q,"\\bigodot ","&#8857;"),De.bigotimes=i(Q,"\\bigotimes ","&#8855;"),De.bigoplus=i(Q,"\\bigoplus ","&#8853;"),De.biguplus=i(Q,"\\biguplus ","&#8846;"),De.lfloor=i(Q,"\\lfloor ","&#8970;"),De.rfloor=i(Q,"\\rfloor ","&#8971;"),De.lceil=i(Q,"\\lceil ","&#8968;"),De.rceil=i(Q,"\\rceil ","&#8969;"),De.opencurlybrace=De.lbrace=i(Q,"\\lbrace ","{"),De.closecurlybrace=De.rbrace=i(Q,"\\rbrace ","}"),De["∫"]=De["int"]=De.integral=i(k,"\\int ","<big>&int;</big>"),De.caret=i(Q,"\\text{^}","^"),De.underscore=i(Q,"\\_","_"),De.slash=i(Q,"/"),De.vert=i(Q,"|"),De.perp=De.perpendicular=i(Q,"\\perp ","&perp;"),De.nabla=De.del=i(Q,"\\nabla ","&nabla;"),De.hbar=i(Q,"\\hbar ","&#8463;"),De.AA=De.Angstrom=De.angstrom=i(Q,"\\text\\AA ","&#8491;"),De.ring=De.circ=De.circle=i(Q,"\\circ ","&#8728;"),De.bull=De.bullet=i(Q,"\\bullet ","&bull;"),De.setminus=De.smallsetminus=i(Q,"\\setminus ","&#8726;"),De.not=De["¬"]=De.neg=i(Q,"\\neg ","&not;"),De["…"]=De.dots=De.ellip=De.hellip=De.ellipsis=De.hellipsis=i(Q,"\\dots ","&hellip;"),De.converges=De.darr=De.dnarr=De.dnarrow=De.downarrow=i(Q,"\\downarrow ","&darr;"),De.dArr=De.dnArr=De.dnArrow=De.Downarrow=i(Q,"\\Downarrow ","&dArr;"),De.diverges=De.uarr=De.uparrow=i(Q,"\\uparrow ","&uarr;"),De.uArr=De.Uparrow=i(Q,"\\Uparrow ","&uArr;"),De.to=i(T,"\\to ","&rarr;"),De.rarr=De.rightarrow=i(Q,"\\rightarrow ","&rarr;"),De.implies=i(T,"\\Rightarrow ","&rArr;"),De.rArr=De.Rightarrow=i(Q,"\\Rightarrow ","&rArr;"),De.gets=i(T,"\\gets ","&larr;"),De.larr=De.leftarrow=i(Q,"\\leftarrow ","&larr;"),De.impliedby=i(T,"\\Leftarrow ","&lArr;"),De.lArr=De.Leftarrow=i(Q,"\\Leftarrow ","&lArr;"),De.harr=De.lrarr=De.leftrightarrow=i(Q,"\\leftrightarrow ","&harr;"),De.iff=i(T,"\\Leftrightarrow ","&hArr;"),De.hArr=De.lrArr=De.Leftrightarrow=i(Q,"\\Leftrightarrow ","&hArr;"),De.Re=De.Real=De.real=i(Q,"\\Re ","&real;"),De.Im=De.imag=De.image=De.imagin=De.imaginary=De.Imaginary=i(Q,"\\Im ","&image;"),De.part=De.partial=i(Q,"\\partial ","&part;"),De.infty=De.infin=De.infinity=i(Q,"\\infty ","&infin;"),De.alef=De.alefsym=De.aleph=De.alephsym=i(Q,"\\aleph ","&alefsym;"),De.xist=De.xists=De.exist=De.exists=i(Q,"\\exists ","&exist;"),De.and=De.land=De.wedge=i(Q,"\\wedge ","&and;"),De.or=De.lor=De.vee=i(Q,"\\vee ","&or;"),De.o=De.O=De.empty=De.emptyset=De.oslash=De.Oslash=De.nothing=De.varnothing=i(T,"\\varnothing ","&empty;"),De.cup=De.union=i(T,"\\cup ","&cup;"),De.cap=De.intersect=De.intersection=i(T,"\\cap ","&cap;"),De.deg=De.degree=i(Q,"^\\circ ","&deg;"),De.ang=De.angle=i(Q,"\\angle ","&ang;"),E=Oe(k,function(t,e){t.init=function(t,n){e.init.call(this,t,"<var>"+(n||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return!this[je]||this[je]instanceof E||this[je]instanceof T||(t="*"+t),!this[ke]||this[ke]instanceof T||"^"===this[ke].ctrlSeq||(t+="*"),t}}),g.p.autoCommands={_maxLength:0},b.autoCommands=function(t){var e,n,i,s,r;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},i=0,s=0;s<e.length;s+=1){if(r=e[s],r.length<2)throw'autocommand "'+r+'" not minimum length of 2';if(De[r]===B)throw'"'+r+'" is a built-in operator name';n[r]=1,i=xe(i,r.length)}return n._maxLength=i,n},R=Oe(E,function(t,e){function n(t){return t instanceof k&&!(t instanceof T)}t.init=function(t){return e.init.call(this,this.letter=t)},t.createLeftOf=function(t){var n,i,s,r=t.options.autoCommands,o=r._maxLength;if(o>0){for(n=this.letter,i=t[je],s=1;i instanceof R&&o>s;)n=i.letter+n,i=i[je],s+=1;for(;n.length;){if(r.hasOwnProperty(n)){for(s=2,i=t[je];s<n.length;s+=1,i=i[je]);return Se(i,t[je]).remove(),t[je]=i[je],De[n](n).createLeftOf(t)}n=n.slice(1)}}e.createLeftOf.apply(this,arguments)},t.italicize=function(t){return this.jQ.toggleClass("mq-operator-name",!t),this},t.finalizeTree=t.siblingDeleted=t.siblingCreated=function(t,e){e!==je&&this[ke]instanceof R||this.autoUnItalicize(t)},t.autoUnItalicize=function(t){var e,i,s,r,o,a,c,l,u,h,f,p=t.autoOperatorNames;if(0!==p._maxLength){for(e=this.letter,i=this[je];i instanceof R;i=i[je])e=i.letter+e;for(s=this[ke];s instanceof R;s=s[ke])e+=s.letter;Se(i[ke]||this.parent.ends[je],s[je]||this.parent.ends[ke]).each(function(t){t.italicize(!0).jQ.removeClass("mq-first mq-last"),t.ctrlSeq=t.letter});t:for(r=0,o=i[ke]||this.parent.ends[je];r<e.length;r+=1,o=o[ke])for(a=we(p._maxLength,e.length-r);a>0;a-=1)if(c=e.slice(r,r+a),p.hasOwnProperty(c)){for(l=0,u=o;a>l;l+=1,u=u[ke])u.italicize(!1),h=u;f=I.hasOwnProperty(c),o.ctrlSeq=(f?"\\":"\\operatorname{")+o.ctrlSeq,h.ctrlSeq+=f?" ":"}",z.hasOwnProperty(c)&&h[je][je][je].jQ.addClass("mq-last"),n(o[je])&&o.jQ.addClass("mq-first"),n(h[ke])&&h.jQ.addClass("mq-last"),r+=a-1,o=h;continue t}}}}),I={},z={limsup:1,liminf:1,projlim:1,injlim:1},function(){var t,e,n,i=g.p.autoOperatorNames={_maxLength:9},s="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" ");for(t=0;t<s.length;t+=1)I[s[t]]=i[s[t]]=1;for(e="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),t=0;t<e.length;t+=1)I[e[t]]=1;for(n="sin cos tan sec cosec csc cotan cot ctg".split(" "),t=0;t<n.length;t+=1)i[n[t]]=i["arc"+n[t]]=i[n[t]+"h"]=i["ar"+n[t]+"h"]=i["arc"+n[t]+"h"]=1}(),b.autoOperatorNames=function(t){var e,n,i,s,r;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},i=0,s=0;s<e.length;s+=1){if(r=e[s],r.length<2)throw'"'+r+'" not minimum length of 2';n[r]=1,i=xe(i,r.length)}return n._maxLength=i,n},B=Oe(k,function(t){t.init=function(t){this.ctrlSeq=t},t.createLeftOf=function(t){var e,n=this.ctrlSeq;for(e=0;e<n.length;e+=1)R(n.charAt(e)).createLeftOf(t)},t.parser=function(){var t,e=this.ctrlSeq,n=C();for(t=0;t<e.length;t+=1)R(e.charAt(t)).adopt(n,n.ends[ke],0);return x.succeed(n.children())}});for(P in I)I.hasOwnProperty(P)&&(De[P]=B);De.operatorname=Oe(j,function(e){e.createLeftOf=t,e.numBlocks=function(){return 1},e.parser=function(){return y.block.map(function(t){return t.children()})}}),De.f=Oe(R,function(t,e){t.init=function(){k.p.init.call(this,this.letter="f",'<var class="mq-florin">&fnof;</var>')},t.italicize=function(t){return this.jQ.html(t?"&fnof;":"f").toggleClass("mq-florin",t),e.italicize.apply(this,arguments)}}),De[" "]=De.space=i(Q,"\\ "," "),De["'"]=De.prime=i(Q,"'","&prime;"),De.backslash=i(Q,"\\backslash ","\\"),_e["\\"]||(_e["\\"]=De.backslash),De.$=i(Q,"\\$","$"),F=Oe(k,function(t,e){t.init=function(t,n){e.init.call(this,t,'<span class="mq-nonSymbola">'+(n||t)+"</span>")}}),De["@"]=F,De["&"]=i(F,"\\&","&amp;"),De["%"]=i(F,"\\%","%"),De.alpha=De.beta=De.gamma=De.delta=De.zeta=De.eta=De.theta=De.iota=De.kappa=De.mu=De.nu=De.xi=De.rho=De.sigma=De.tau=De.chi=De.psi=De.omega=Oe(E,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),De.phi=i(E,"\\phi ","&#981;"),De.phiv=De.varphi=i(E,"\\varphi ","&phi;"),De.epsilon=i(E,"\\epsilon ","&#1013;"),De.epsiv=De.varepsilon=i(E,"\\varepsilon ","&epsilon;"),De.piv=De.varpi=i(E,"\\varpi ","&piv;"),De.sigmaf=De.sigmav=De.varsigma=i(E,"\\varsigma ","&sigmaf;"),De.thetav=De.vartheta=De.thetasym=i(E,"\\vartheta ","&thetasym;"),De.upsilon=De.upsi=i(E,"\\upsilon ","&upsilon;"),De.gammad=De.Gammad=De.digamma=i(E,"\\digamma ","&#989;"),De.kappav=De.varkappa=i(E,"\\varkappa ","&#1008;"),De.rhov=De.varrho=i(E,"\\varrho ","&#1009;"),De.pi=De["π"]=i(F,"\\pi ","&pi;"),De.lambda=i(F,"\\lambda ","&lambda;"),De.Upsilon=De.Upsi=De.upsih=De.Upsih=i(k,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),De.Gamma=De.Delta=De.Theta=De.Lambda=De.Xi=De.Pi=De.Sigma=De.Phi=De.Psi=De.Omega=De.forall=Oe(Q,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),$=Oe(j,function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){var e=y.parse(this.latex);e.children().adopt(t.parent,t[je],t[ke]),t[je]=e.ends[ke],e.jQize().insertBefore(t.jQ),e.finalizeInsert(t.options,t),e.ends[ke][ke].siblingCreated&&e.ends[ke][ke].siblingCreated(t.options,je),e.ends[je][je].siblingCreated&&e.ends[je][je].siblingCreated(t.options,ke),t.parent.bubble("reflow")},t.parser=function(){var t=y.parse(this.latex).children();return x.succeed(t)}}),De["¹"]=i($,"^1"),De["²"]=i($,"^2"),De["³"]=i($,"^3"),De["¼"]=i($,"\\frac14"),De["½"]=i($,"\\frac12"),De["¾"]=i($,"\\frac34"),M=Oe(T,function(t){t.init=Q.prototype.init,t.contactWeld=t.siblingCreated=t.siblingDeleted=function(t,e){return e!==ke?(this.jQ[0].className=!this[je]||this[je]instanceof T?"":"mq-binary-operator",this):void 0}}),De["+"]=i(M,"+","+"),De["–"]=De["-"]=i(M,"-","&minus;"),De["±"]=De.pm=De.plusmn=De.plusminus=i(M,"\\pm ","&plusmn;"),De.mp=De.mnplus=De.minusplus=i(M,"\\mp ","&#8723;"),_e["*"]=De.sdot=De.cdot=i(T,"\\cdot ","&middot;"),N=Oe(T,function(t,e){t.init=function(t,n){this.data=t,this.strict=n;var i=n?"Strict":"";e.init.call(this,t["ctrlSeq"+i],t["html"+i],t["text"+i])},t.swap=function(t){this.strict=t;var e=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+e],this.jQ.html(this.data["html"+e]),this.textTemplate=[this.data["text"+e]]},t.deleteTowards=function(t){return t!==je||this.strict?void e.deleteTowards.apply(this,arguments):void this.swap(!0)}}),U={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},W={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"},De["<"]=De.lt=i(N,U,!0),De[">"]=De.gt=i(N,W,!0),De["≤"]=De.le=De.leq=i(N,U,!1),De["≥"]=De.ge=De.geq=i(N,W,!1),H=Oe(T,function(t,e){t.init=function(){e.init.call(this,"=","=")},t.createLeftOf=function(t){return t[je]instanceof N&&t[je].strict?void t[je].swap(!1):void e.createLeftOf.apply(this,arguments)}}),De["="]=H,De.times=i(T,"\\times ","&times;","[x]"),De["÷"]=De.div=De.divide=De.divides=i(T,"\\div ","&divide;","[/]"),K=t,X=document.createElement("div"),Z=X.style,Y={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(V in Y)if(V in Z){J=V;break}J?G=function(t,e,n){t.css(J,"scale("+e+","+n+")")}:"filter"in Z?(K=function(t){t.className=t.className},G=function(t,e,n){function i(){t.css("marginRight",(s.width()-1)*(e-1)/e+"px")}var s,r;e/=1+(n-1)/2,t.css("fontSize",n+"em"),t.hasClass("mq-matrixed-container")||t.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>'),s=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')"),i(),r=setInterval(i),Qe(window).load(function(){clearTimeout(r),i()})}):G=function(t,e,n){t.css("fontSize",n+"em")},te=Oe(j,function(t,e){t.init=function(t,n,i){e.init.call(this,t,"<"+n+" "+i+">&0</"+n+">")}}),De.mathrm=i(te,"\\mathrm","span",'class="mq-roman mq-font"'),De.mathit=i(te,"\\mathit","i",'class="mq-font"'),De.mathbf=i(te,"\\mathbf","b",'class="mq-font"'),De.mathsf=i(te,"\\mathsf","span",'class="mq-sans-serif mq-font"'),De.mathtt=i(te,"\\mathtt","span",'class="mq-monospace mq-font"'),De.underline=i(te,"\\underline","span",'class="mq-non-leaf mq-underline"'),De.overline=De.bar=i(te,"\\overline","span",'class="mq-non-leaf mq-overline"'),ee=De.textcolor=Oe(j,function(t,e){t.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'},t.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},t.parser=function(){var t=this,n=x.optWhitespace,i=x.string,s=x.regex;return n.then(i("{")).then(s(/^[#\w\s.,()%-]*/)).skip(i("}")).then(function(n){return t.setColor(n),e.parser.call(t)})}}),ne=De["class"]=Oe(j,function(t,e){t.parser=function(){var t=this,n=x.string,i=x.regex;return x.optWhitespace.then(n("{")).then(i(/^[-\w\s\\\xA0-\xFF]*/)).skip(n("}")).then(function(n){return t.htmlTemplate='<span class="mq-class '+n+'">&0</span>',e.parser.call(t)})}}),ie=Oe(j,function(t,e){t.ctrlSeq="_{...}^{...}",t.createLeftOf=function(t){return t[je]||!t.options.supSubsRequireOperand?e.createLeftOf.apply(this,arguments):void 0},t.contactWeld=function(t){var e,n,i,s,r,o;for(e=je;e;e=e===je?ke:!1)if(this[e]instanceof ie){for(n="sub";n;n="sub"===n?"sup":!1)i=this[n],s=this[e][n],i&&(s?i.isEmpty()?o=Te(s,0,s.ends[je]):(i.jQ.children().insAtDirEnd(-e,s.jQ),r=i.children().disown(),o=Te(s,r.ends[ke],s.ends[je]),e===je?r.adopt(s,s.ends[ke],0):r.adopt(s,0,s.ends[je])):this[e].addBlock(i.disown()),this.placeCursor=function(t,n){return function(i){i.insAtDirEnd(-e,t||n)}}(s,i));this.remove(),t&&t[je]===this&&(e===ke&&o?o[je]?t.insRightOf(o[je]):t.insAtLeftEnd(o.parent):t.insRightOf(this[e]));break}this.respace()},g.p.charsThatBreakOutOfSupSub="",t.finalizeTree=function(){this.ends[je].write=function(t,e){t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1&&t.insRightOf(this.parent),C.p.write.apply(this,arguments)}},t.latex=function(){function t(t,e){var n=e&&e.latex();return e?t+(1===n.length?n:"{"+(n||" ")+"}"):""}return t("_",this.sub)+t("^",this.sup)},t.respace=t.siblingCreated=t.siblingDeleted=function(t,e){e!==ke&&this.jQ.toggleClass("mq-limit","\\int "===this[je].ctrlSeq)},t.addBlock=function(t){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=Qe('<span class="mq-sup"/>').append(t.jQ.children()).attr(ve,t.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=Qe('<span class="mq-sub"></span>').append(t.jQ.children()).attr(ve,t.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&nbsp;</span>'));for(var e=0;2>e;e+=1)(function(t,e,n,i){t[e].deleteOutOf=function(s,r){r.insDirOf(s,this.parent),this.isEmpty()||(r[-s]=this.ends[s],this.children().disown().withDirAdopt(s,r.parent,r[s],this.parent).jQ.insDirOf(s,this.parent.jQ)),t.supsub=n,delete t[e],delete t[i+"Into"],t[n][i+"OutOf"]=h,delete t[n].deleteOutOf,"sub"===e&&Qe(t.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}})(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])}}),se=Oe(j,function(t,e){t.init=function(t,e){var n='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+e+'</big><span class="mq-from"><span>&0</span></span></span>';k.prototype.init.call(this,t,n)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments),t.options.sumStartsWithNEquals&&(R("n").createLeftOf(t),H().createLeftOf(t))},t.latex=function(){function t(t){return 1===t.length?t:"{"+(t||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[je].latex())+"^"+t(this.ends[ke].latex())},t.parser=function(){var t,e=x.string,n=x.optWhitespace,i=x.succeed,s=y.block,r=this,o=r.blocks=[C(),C()];for(t=0;t<o.length;t+=1)o[t].adopt(r,r.ends[ke],0);return n.then(e("_").or(e("^"))).then(function(t){var e=o["_"===t?0:1];return s.then(function(t){return t.children().adopt(e,e.ends[ke],0),i(r)})}).many().result(r)},t.finalizeTree=function(){this.downInto=this.ends[je],this.upInto=this.ends[ke],this.ends[je].upOutOf=this.ends[ke],this.ends[ke].downOutOf=this.ends[je]}}),De["∑"]=De.sum=De.summation=i(se,"\\sum ","&sum;"),De["∏"]=De.prod=De.product=i(se,"\\prod ","&prod;"),De.coprod=De.coproduct=i(se,"\\coprod ","&#8720;"),De.subscript=De._=Oe(ie,function(t,e){t.supsub="sub",t.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&nbsp;</span></span>',t.textTemplate=["_"],t.finalizeTree=function(){this.downInto=this.sub=this.ends[je],this.sub.upOutOf=h,e.finalizeTree.call(this)}}),De.superscript=De.supscript=De["^"]=Oe(ie,function(t,e){t.supsub="sup",t.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',t.textTemplate=["**"],t.finalizeTree=function(){this.upInto=this.sup=this.ends[ke],this.sup.downOutOf=h,e.finalizeTree.call(this)}}),re=De.frac=De.dfrac=De.cfrac=De.fraction=Oe(j,function(t){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&nbsp;</span></span>',t.textTemplate=["(","/",")"],t.finalizeTree=function(){this.upInto=this.ends[ke].upOutOf=this.ends[je],this.downInto=this.ends[je].downOutOf=this.ends[ke]}}),oe=De.over=_e["/"]=Oe(re,function(e,n){e.createLeftOf=function(e){if(!this.replacedFragment){for(var i=e[je];i&&!(i instanceof T||i instanceof(De.text||t)||i instanceof se||"\\ "===i.ctrlSeq||/^[,;:]$/.test(i.ctrlSeq));)i=i[je];i instanceof se&&i[ke]instanceof ie&&(i=i[ke],i[ke]instanceof ie&&i[ke].ctrlSeq!=i.ctrlSeq&&(i=i[ke])),i!==e[je]&&(this.replaces(Se(i[ke]||e.parent.ends[je],e[je])),e[je]=i)}n.createLeftOf.call(this,e)}}),ae=De.sqrt=De["√"]=Oe(j,function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.parser=function(){return y.optBlock.then(function(t){return y.block.map(function(e){var n=le();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(e.parser.call(this))},t.reflow=function(){var t=this.ends[ke].jQ;G(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),ce=De.vec=Oe(j,function(t){t.ctrlSeq="\\vec",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-vector-prefix">&rarr;</span><span class="mq-vector-stem">&0</span></span>',t.textTemplate=["vec(",")"]}),le=De.nthroot=Oe(ae,function(t){t.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',t.textTemplate=["sqrt[","](",")"],t.latex=function(){return"\\sqrt["+this.ends[je].latex()+"]{"+this.ends[ke].latex()+"}"}}),ue=Oe(Oe(j,f),function(e,n){e.init=function(t,e,i,s,r){n.init.call(this,"\\left"+s,d,[e,i]),this.side=t,this.sides={},this.sides[je]={ch:e,ctrlSeq:s},this.sides[ke]={ch:i,ctrlSeq:r}},e.numBlocks=function(){return 1},e.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===ke?" mq-ghost":"")+'">'+this.sides[je].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===je?" mq-ghost":"")+'">'+this.sides[ke].ch+"</span></span>",n.html.call(this)},e.latex=function(){return"\\left"+this.sides[je].ctrlSeq+this.ends[je].latex()+"\\right"+this.sides[ke].ctrlSeq},e.oppBrack=function(t,e){return t instanceof ue&&t.side&&t.side!==-e&&("|"===this.sides[this.side].ch||t.side===-this.side)&&t},e.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side],t.delimjQs.eq(this.side===je?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},e.createLeftOf=function(t){var e,i;this.replacedFragment||(e=this.oppBrack(t[je],je)||this.oppBrack(t[ke],ke)||this.oppBrack(t.parent.parent)),e?(i=this.side=-e.side,this.closeOpposing(e),e===t.parent.parent&&t[i]&&(Se(t[i],t.parent.ends[i],-i).disown().withDirAdopt(-i,e.parent,e,e[i]).jQ.insDirOf(i,e.jQ),e.bubble("reflow"))):(e=this,i=e.side,e.replacedFragment?e.side=0:t[-i]&&(e.replaces(Se(t[-i],t.parent.ends[-i],i)),t[-i]=0),n.createLeftOf.call(e,t)),i===je?t.insAtLeftEnd(e.ends[je]):t.insRightOf(e)},e.placeCursor=t,e.unwrap=function(){this.ends[je].children().disown().adopt(this.parent,this,this[ke]).jQ.insertAfter(this.jQ),this.remove()},e.deleteSide=function(t,e,n){var i,s=this.parent,r=this[t],o=s.ends[t];return t===this.side?(this.unwrap(),void(r?n.insDirOf(-t,r):n.insAtDirEnd(t,s))):(this.side=-t,void(this.oppBrack(this.ends[je].ends[this.side],t)?(this.closeOpposing(this.ends[je].ends[this.side]),i=this.ends[je].ends[t],this.unwrap(),i.siblingCreated&&i.siblingCreated(n.options,t),r?n.insDirOf(-t,r):n.insAtDirEnd(t,s)):(this.oppBrack(this.parent.parent,t)?(this.parent.parent.closeOpposing(this),this.parent.parent.unwrap()):(this.sides[t]={ch:he[this.sides[this.side].ch],ctrlSeq:he[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(t===je?0:1).addClass("mq-ghost").html(this.sides[t].ch)),r?(i=this.ends[je].ends[t],Se(r,o,-t).disown().withDirAdopt(-t,this.ends[je],i,0).jQ.insAtDirEnd(t,this.ends[je].jQ.removeClass("mq-empty")),i.siblingCreated&&i.siblingCreated(n.options,t),n.insDirOf(-t,r)):e?n.insDirOf(t,this):n.insAtDirEnd(t,this.ends[je]))))},e.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},e.finalizeTree=function(){this.ends[je].deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===je?1:0).removeClass("mq-ghost"),this.side=0}},e.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()}}),he={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|"},p("("),p("["),p("{","\\{"),De.langle=i(ue,je,"&lang;","&rang;","\\langle ","\\rangle "),De.rangle=i(ue,ke,"&lang;","&rang;","\\langle ","\\rangle "),_e["|"]=i(ue,je,"|","|","|","|"),De.left=Oe(j,function(t){t.parser=function(){var t=x.regex,e=x.string,n=(x.succeed,x.optWhitespace);
return n.then(t(/^(?:[([|]|\\\{)/)).then(function(i){var s="\\"===i.charAt(0)?i.slice(1):i;return y.then(function(r){return e("\\right").skip(n).then(t(/^(?:[\])|]|\\\})/)).map(function(t){var e="\\"===t.charAt(0)?t.slice(1):t,n=ue(0,s,e,i,t);return n.blocks=[r],r.adopt(n,0,0),n})})})}}),De.right=Oe(j,function(t){t.parser=function(){return x.fail("unmatched \\right")}}),fe=De.binom=De.binomial=Oe(Oe(j,f),function(t){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',t.textTemplate=["choose(",",",")"]}),pe=De.choose=Oe(fe,function(t){t.createLeftOf=oe.prototype.createLeftOf}),de=Oe(a.MathField,function(t){t.init=function(t,e){l(t),this.__options=g();var n=Ee(this,t,e);n.editable=!0,n.createTextarea(),n.editablesTextareaEvents(),n.cursor.insAtRightEnd(t)}}),De.MathQuillMathField=Oe(j,function(t,e){t.ctrlSeq="\\MathQuillMathField",t.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',t.parser=function(){var t=this,n=x.string,i=x.regex,s=x.succeed;return n("[").then(i(/^[a-z][a-z0-9]*/i)).skip(n("]")).map(function(e){t.name=e}).or(s()).then(e.parser.call(t))},t.finalizeTree=function(){de(this.ends[je],this.jQ)},t.registerInnerField=function(t){t.push(t[this.name]=this.ends[je].controller.API)},t.latex=function(){return this.ends[je].latex()},t.text=function(){return this.ends[je].text()}}),me=_e["\\"]=Oe(j,function(t,e){t.ctrlSeq="\\",t.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t.createBlocks=function(){e.createBlocks.call(this),this.ends[je].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[je].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[je].write=function(t,e,n){n&&n.remove(),e.match(/[a-z]/i)?Q(e).createLeftOf(t):(this.parent.renderCommand(t),"\\"===e&&this.isEmpty()||this.parent.parent.write(t,e))},this.ends[je].keystroke=function(t,n,i){return"Tab"===t||"Enter"===t||"Spacebar"===t?(this.parent.renderCommand(i.cursor),void n.preventDefault()):e.keystroke.apply(this,arguments)}},t.createLeftOf=function(t){if(e.createLeftOf.call(this,t),this._replacedFragment){var n=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(t){return Qe(t.target=n).trigger(t),!1}).insertBefore(this.jQ).add(this.jQ)}},t.latex=function(){return"\\"+this.ends[je].latex()+" "},t.renderCommand=function(t){var e,n;this.jQ=this.jQ.last(),this.remove(),this[ke]?t.insLeftOf(this[ke]):t.insAtRightEnd(this.parent),e=this.ends[je].latex(),e||(e=" "),n=De[e],n?(n=n(e),this._replacedFragment&&n.replaces(this._replacedFragment),n.createLeftOf(t)):(n=D(),n.replaces(e),n.createLeftOf(t),t.insRightOf(n),this._replacedFragment&&this._replacedFragment.remove())}})}();